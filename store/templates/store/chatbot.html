<!-- chat.html -->
{% extends 'store/main.html' %}
{% block content %}
    <style>

      body { font-family: Arial, sans-serif; background-color: #f0f0f0; margin: 0; padding: 0; }

      .container { max-width: 600px; margin: 50px auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }

      h1 { text-align: center; }

      #chat-box { overflow-y: scroll; max-height: 300px; }

      .message { margin-bottom: 10px; padding: 8px 12px; border-radius: 10px; max-width: 70%; }

      .message-user { background-color: #DCF8C6; align-self: flex-end; }

      .message-sender { background-color: #E5E5EA; align-self: flex-start; }

      form { display: flex; margin-top: 10px; }

      input[type="text"] { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }

      button { padding: 8px 20px; border: none; background-color: #4CAF50; color: white; border-radius: 5px; cursor: pointer; }</style>
  </head>

  <body>
    <div class="container">
      <h1>HealthCare ChatBot</h1>
      <div id="chat-box">
        <!-- Display the initial message here -->
        <div class="message server-message">{{ server_message }}</div>
      </div>
      <form id="message-form">
        {% csrf_token %}
        <input type="text" id="user-message" placeholder="Type your message..." />
        <button type="submit">Send</button>
      </form>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      // script.js
      
      $(document).ready(function () {
        // Function to add a message to the chat box
        function addMessage(message, sender) {
          $('#chat-box').append('<div class="message message-' + sender + '">' + message + '</div>')
          // Scroll to the bottom of the chat box
          $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight)
        }
      
        // Form submission
        $('#message-form').submit(function (event) {
          event.preventDefault()
          var csrftoken = $('[name=csrfmiddlewaretoken]').val()
          var userMessage = $('#user-message').val()
          addMessage(userMessage, 'user')
          // Send user's message to the server
          $.ajax({
            type: 'POST',
            url: '/chatbot/',
            headers: { 'X-CSRFToken': csrftoken },
            data: {
              message: userMessage
            },
            success: function (response) {
              console.log(response)
              addMessage(response.message, 'server')
            },
            error: function (xhr, errmsg, err) {
              console.log(xhr.status + ': ' + xhr.responseText)
            }
          })
          // Clear input field
          $('#user-message').val('')
        })
      })
    </script>
  </body>
  {% endblock %}
